!function(){"use strict";var t={type:[4,6,14,19,29],status:[1,3,4,5,1e4,10001,10003,10004,10005,10007,10010,10011,10012,10014,10015,10017,10018,10019,10020,10021,10022,10023,10024,10025,10026,10027,10028,10029,10030,10031,10032,10033,10034,10035,10036,10037,10038,10039,10040,10041,10042,10043,10044,10045,10046,10047,10048,10049,10050,10051,10052]};angular.module("JiraModule",[]).provider("jiraService",function(){var e=this;e.setBaseUrl=function(t){e.base_url=t,e.projects_url=t+"/secure/BrowseProjects.jspa",e.search_url=t+"/sr/jira.issueviews:searchrequest-xml/temp/SearchRequest.xml",e.issue_url=t+"/si/jira.issueviews:issue-xml",e.profile_url=t+"/secure/ViewProfile.jspa"},e.$get=["$http",function(n){function r(t){return n.get(t,{withCredentials:!0}).then(function(t){return $.parseHTML(t.data.replace(/<img[^>]*>/g,""))})}function s(t,e){return void 0===e&&(e={}),n({method:"GET",url:t,params:e,withCredentials:!0}).then(function(t){return $.parseXML(t.data)})}function a(){return l.then(function(t){return $(t).find("#account-options li:nth-child(1) a").text()})}function i(){return l.then(function(t){var e=[],n=[],r="",s={},a={},i=[];return n=$(t).find("tbody tr td b:contains(Руководитель проекта)").parent().parent().parent(),$.each(n,function(t,n){r=$(n).find("h3.formtitle").text().substr(12)||"Без категории",i=$(n).find('tr[bgcolor="ffffff"]'),$.each(i,function(t,n){s=$(n).find("td:nth-child(1) a")[0],a=$(n).find("td:nth-child(2)")[0],e.push({category:r,name:$(s).text(),url:$(s).attr("href"),code:$(a).text().trim()})})}),e})}function u(t){return r(e.base_url+t).then(function(t){return $(t).find("#create_issue_for_project").attr("href").split("?pid=")[1]})}function c(n){return s(e.search_url,{pid:n,type:t.type,status:t.status}).then(d)}function o(t){return s(e.issue_url+"/"+t+"/").then(d).then(function(t){return t[0]})}function d(t){function n(t,e){var n=$(t).children(e)[0];return $(n).text()}function r(t,e){var n=t.children('customfield[id="customfield_'+e+'"]')[0],r=$(n).children("customfieldvalues")[0],s=$(r).children("customfieldvalue")[0];return $(s).text()}for(var s,a,i,u,c,o=[],d=$(t).find("item"),l=d.length;--l>=0;)s=$(d[l]),a=$(s.children("comments")[0]),i=$(s.children("customfields")[0]),u=$(a.children("comment")[0]),c={url:n(s,"link"),code:n(s,"key"),name:n(s,"title"),description:n(s,"description"),status:n(s,"status"),assignee:n(s,"assignee"),updated:n(s,"updated"),last_comment:{text:u.text(),date:new Date(u.attr("created")),author:u.attr("author")},analyst_starts:r(i,10363),analyst_ends:r(i,10002),analyst_comment:r(i,10195),dev_starts:r(i,10362)},c.name=c.name.substr(c.name.indexOf("] ")+2),c.updated=new Date(c.updated),c.analyst_starts=new Date(c.analyst_starts),c.analyst_ends=new Date(c.analyst_ends),c.dev_starts=new Date(c.dev_starts),c.last_comment.author_url=e.profile_url+"?name="+c.last_comment.author,o.push(c);return o}var l=r(e.projects_url);return{getUser:a,getSystems:i,getPid:u,getTasks:c,getTask:o}}]})}();
//# sourceMappingURL=angular-jira.min.map