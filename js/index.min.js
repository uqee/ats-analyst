!function(){var e=angular.module("maria",["ngSanitize","ngAnimate","LocalStorageModule","JiraModule","xeditable","ui.bootstrap"]);e.config(["localStorageServiceProvider",function(e){e.setPrefix("maria")}]),e.config(["jiraServiceProvider",function(e){e.setBaseUrl("http://jira")}]),e.run(["editableOptions",function(e){e.theme="bs3"}]),e.controller("myController",["$scope","$timeout","localStorageService","jiraService",function(e,t,n,o){function i(){for(var e=n.get("tasks")||[],t=e.length;--t>=0;)e[t].pinned=!0;return e}function c(){for(var t=e.pinned_tasks,n=t.length;--n>=0;)!function(n){t[n].updating=!0,o.getTask(t[n].code).then(function(o){o.local_comment=t[n].local_comment,o.updating=!1,e.pinned_tasks[n]=o})}(n)}function a(e){var t=[];angular.forEach(e,function(e){var n={};n.code=e.code,n.url=e.url,n.local_comment=e.local_comment,t.push(n)}),n.set("tasks",t)}function r(t){for(var n=e.pinned_tasks,o=n.length-1;o>=0&&n[o].code!==t.code;)o--;return o+1}function s(t){if(t.code){var n=e.pinned_tasks,o=r(t);t.pinned?(t.pinned=!1,n.splice(o-1,1)):(t.pinned=!0,n.push(t)),a(n)}}function l(e){var t=/^[a-zA-Z]{1,10}-[0-9]{1,5}$/;e.error=!1,e.valid=t.test(e.code)}function u(t){for(var n,o,i=t.code,c=t.code.split("-")[0],a=e.systems,r=a.length;--r>=0&&a[r].code!==c;);if(r>=0)for(n=a[r].tasks,o=n.length;--o>=0;)if(n[o].code=i){n[o]=t;break}}function d(t,n){var o=e.pinned_tasks,i=r(n),n=o[i-1];n.local_comment=t,a(o),u(n)}function f(t){if(!t.updating){t.updating=!0,t.code=t.code.toUpperCase();var n=e.pinned_tasks,i=r(t);i?o.getTask(t.code).then(function(e){e.local_comment=t.local_comment,n[i-1]=e,u(e),t.updating=!1,t.code=""}):(t.error="",o.getTask(t.code).then(function(n){e.pinned_tasks.push(n),a(e.pinned_tasks),u(n),t.code="",t.valid=!1,t.updating=!1},function(){t.updating=!1,t.error=!0}))}}function p(){return n.get("systems")||[]}function m(e){var t=[];angular.forEach(e,function(e){var n={};n.pid=e.pid,n.url=e.url,n.code=e.code,n.name=e.name,n.category=e.category,t.push(n)}),n.set("systems",t)}function g(e,t){if(e.code){for(var n=t.length-1;n>=0&&t[n].code!==e.code;)n--;0>n&&o.getPid(e.url).then(function(n){e.pid=n,e.opened=!1,t.push(e),m(t)})}}function k(e,t){t.splice(t.indexOf(e),1),m(t)}function v(t){t.tasks=void 0,o.getTasks(t.pid).then(function(n){for(var o=e.pinned_tasks,i=o.length,c=n.length;--i>=0;)for(;--c>=0;)if(n[c].code===o[i].code){n[c].pinned=!0,n[c].local_comment=o[i].local_comment,o[i]=n[c];break}t.tasks=n})}e.connection_timeout=!1,t(function(){e.connection_timeout=!0},3e3),e.addLocalSystem=g,e.delLocalSystem=k,e.getTasks=v,e.taskIsPinned=r,e.toggleLocalTask=s,e.updateLocalComment=d,e.updateLocalTask=f,e.validateTaskCode=l,o.getUser().then(function(t){e.user=t}),e.pinned_tasks=i(),c(),e.systems={_new:{}},e.systems.local=p(),o.getSystems().then(function(t){e.systems.jira=t,e.selectpicker()}),e.selectpicker={},e.collapse={},e.collapse.newSystem=!0,e.collapse.newTask=!0,e.newTask={code:""}}]),e.directive("mySelectpicker",["$timeout",function(e){return{restrict:"A",link:function(t,n){t.selectpicker=function(){e(function(){n.selectpicker()},200)}}}}]),e.directive("task",[function(){return{restrict:"E",templateUrl:"./templates/task.html"}}]),e.directive("collapseWatcher",[function(){return{restrict:"A",scope:{collapseWatcher:"="},link:function(e,t){t.bind("click",function(){var n=e.$parent.$parent,o=e.collapseWatcher,i=t.next().hasClass("in");for(systems=n.systems.local,s=systems.length;--s>=0;)systems[s].opened=!1;o.opened=!i,e.$apply(),i||o.tasks||n.getTasks(o)})}}}]),e.filter("datetime",function(){return function(e){function t(e){return 9>=e?"0"+e:""+e}function n(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:!isNaN(e.getTime())}if(!n(e))return"пусто";var o="",i=e.getMinutes(),c=e.getHours(),a=e.getDate(),r=e.getMonth()+1,s=e.getFullYear();return o+=t(a)+"."+t(r)+"."+t(s),(i||c)&&(o+=", "+t(c)+":"+t(i)),o}}),e.filter("estdatetime",function(){return function(e){function t(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:!isNaN(e.getTime())}function n(e,t){var o,i,c=0;if(e>t)return-n(t,e);var a=e.getDay(),r=t.getDay();return a=0==a?7:a,r=0==r?7:r,a>5&&r>5&&(c=1),a=a>5?5:a,r=r>5?5:r,o=Math.floor((t.getTime()-e.getTime())/6048e5),i=r>=a?5*o+(r-a):5*(o+1)-(a-r),i-=c,i+1}if(!t(e))return"";var o=new Date,i=n(o,e);return i}})}();
//# sourceMappingURL=index.min.map